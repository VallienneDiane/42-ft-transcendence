version: '3.3'
services:
########################################## POSTGRESQL - DATABASE ##############################
  db:
    image: postgres:latest
    container_name: db_container
    hostname: postgres
    restart: always
    env_file:
      - .env
    volumes:
      - db:/var/lib/postgresql/data
    networks:
      - transcendence_network
########################################## BACK-END NEST JS ##################################
  back:
    image: nestjs_img
    build:
      context: ./back
    container_name: nest_container
    restart: always
    ports:
      - "3000:3000"
    networks:
      - transcendence_network
    volumes:
      - back:/usr/src/app
########################################## FRONT-END REACT VITE  ############################
  front:
    image: reactjs_img
    build:
      context: ./front
    container_name: react_container
    restart: always
    ports:
      - "8000:8000"
    networks:
      - transcendence_network
    volumes:
      - front:/usr/src/app
########################################### VOLUMES  #########################################
volumes:
  db:
    driver: local
    name: nest-db
    driver_opts:
      type: none 
      o: bind
      device: ./postgres
  back:
    driver: local
    name: back
    driver_opts:
      type: none
      o: bind
      device: ./back
  front:
    driver: local
    name: front
    driver_opts:
      type: none 
      o: bind
      device: ./front
########################################## NETWORK  ########################################
networks:
  transcendence_network:
    driver: bridge
    name: transcendence_network
